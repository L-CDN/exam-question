<!DOCTYPE html>
<html>
  <head>
    <title>Alberta Active Fires</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.css"
    />
    <style>
      #mapid {
        height: 600px;
      }
    </style>
  </head>

  <body>
    <div id="mapid"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.3/leaflet.js"></script>
    <script>
      var map = L.map("mapid").setView([55, -113], 5);

      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors',
      }).addTo(map);

      fetch(
        "https://cwfis.cfs.nrcan.gc.ca/geoserver/public/ows?service=WFS&version=1.0.0&request=GetFeature&typeName=public:activefires_current&srsname=EPSG:4326&outputFormat=json"
      )
        .then((response) => response.json())
        .then((data) => {
          L.geoJSON(data.features, {
            style: function (feature) {
              var options = {
                color: "#FF0000",
                weight: 2,
                fillOpacity: 0.5,
              };
              return options;
            },
            onEachFeature: function (feature, layer) {
              /* Create array to hold months of the year */
              var monthsOfTheYear = [
                "Jan",
                "Feb",
                "Mar",
                "Apr",
                "May",
                "Jun",
                "Jul",
                "Aug",
                "Sep",
                "Oct",
                "Nov",
                "Dec",
              ];

              /* Retrieve and Parse the date from the feature */
              var dateData = feature.properties.startdate;
              var date = new Date(dateData);
              var day = date.getDay();
              var month = monthsOfTheYear[date.getMonth()];
              var year = date.getFullYear();

              /*  Display the fire name, stage of control, and start date. */
              var popupContent =
                "<p>" +
                "<b>Fire Name: </b>" +
                feature.properties.firename +
                "<br/>" +
                "<b>Stage of Control: </b>" +
                feature.properties.stage_of_control +
                "<br/>" +
                "<b>Fire Start Date: </b>" +
                month +
                " " +
                day +
                ", " +
                year +
                "</p>";
              layer.bindPopup(popupContent);
            },
            /*  Check that feature has originated in Alberta */
            pointToLayer: function (feature, latlng) {
              if (feature.properties.agency == "ab")
                return L.circleMarker(latlng);
            },
          }).addTo(map);
        });
    </script>
  </body>
</html>
